2025-09-14T00:17:14.646+08:00  INFO 2904 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 2904 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-14T00:17:14.650+08:00  INFO 2904 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-14T00:17:15.112+08:00  INFO 2904 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-14T00:17:15.122+08:00  INFO 2904 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-14T00:17:15.122+08:00  INFO 2904 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-14T00:17:15.160+08:00  INFO 2904 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-14T00:17:15.161+08:00  INFO 2904 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 489 ms
2025-09-14T00:17:15.457+08:00  INFO 2904 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-14T00:17:15.461+08:00  INFO 2904 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 1.113 seconds (process running for 1.522)
2025-09-14T00:17:23.867+08:00  INFO 2904 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14T00:17:23.868+08:00  INFO 2904 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-14T00:17:23.868+08:00  INFO 2904 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2025-09-14T00:17:23.909+08:00  INFO 2904 --- [score-api] [http-nio-8090-exec-1] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-14T00:17:23.918+08:00  INFO 2904 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-14T00:17:24.959+08:00  INFO 2904 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.ibm.db2.jcc.t4.b@202e2b99
2025-09-14T00:17:24.960+08:00  INFO 2904 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-14T00:18:01.536+08:00  INFO 2904 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14T00:18:01.579+08:00  INFO 2904 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-14T00:18:01.583+08:00  INFO 2904 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-14T00:18:01.586+08:00  INFO 2904 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-14T00:26:10.260+08:00  INFO 31312 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 31312 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-14T00:26:10.261+08:00  INFO 31312 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-14T00:26:10.666+08:00  INFO 31312 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-14T00:26:10.671+08:00  INFO 31312 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-14T00:26:10.672+08:00  INFO 31312 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-14T00:26:10.699+08:00  INFO 31312 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-14T00:26:10.699+08:00  INFO 31312 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 418 ms
2025-09-14T00:26:10.978+08:00  INFO 31312 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-14T00:26:10.981+08:00  INFO 31312 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.961 seconds (process running for 1.287)
2025-09-14T00:26:18.578+08:00  INFO 31312 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14T00:26:18.579+08:00  INFO 31312 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-14T00:26:18.580+08:00  INFO 31312 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-09-14T00:26:18.682+08:00  INFO 31312 --- [score-api] [http-nio-8090-exec-1] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-14T00:26:18.711+08:00  INFO 31312 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-14T00:26:19.754+08:00  INFO 31312 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.ibm.db2.jcc.t4.b@4f5017f1
2025-09-14T00:26:19.763+08:00  INFO 31312 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-14T00:26:20.501+08:00 ERROR 31312 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=sd;SELECT
;<space>, DRIVER=4.34.30
### The error may exist in file [F:\Users\lenovo\Desktop\score-api\target\classes\mapper\ScoreMapper.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: WITH             -- 注意这里只声明三列，VALUES 也只给三列，避免 -418             win(w, t_start, t_end) AS (                 VALUES                     (1,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS),                     (2,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS)             ),              -- 顶层（总指数）：每窗一条（优先等于入参秒，否则窗内最新）             top_src AS (                 SELECT                     w.w,                     i.GENERATE_TIME                                    AS gt,                     VARCHAR_FORMAT(i.GENERATE_TIME,'YYYYMMDDHH24MISS') AS markTime,                     i.INDEX_VALUE                                      AS topIndexValue,                     CASE WHEN i.GENERATE_TIME = w.t_start THEN 0 ELSE 1 END AS pref                 FROM win w                          JOIN T_MD_DIAGNOSE_MODEL_DATA_INDEX i                               ON i.INDEX_ID = 'B4TEN_I'                                   AND i.GENERATE_TIME BETWEEN w.t_start AND w.t_end             ),             top_pick AS (                 SELECT w, markTime, gt, topIndexValue                 FROM (                          SELECT w, markTime, gt, topIndexValue,                                 ROW_NUMBER() OVER (PARTITION BY w ORDER BY pref ASC, gt DESC) rn                          FROM top_src                      ) t                 WHERE rn = 1             ),              -- 子指数定义清单（固定顺序 + 兜底占位）             sub_def AS (                 SELECT                     si.SUBINDEX_ID,                     si.SUBINDEX_NAME,                     si.SUBINDEX_ID   AS subIndexCode,                     si.WEIGHT     AS subIndexWeight,                     CASE si.SUBINDEX_NAME                         WHEN '下料稳定性' THEN 1                         WHEN '压量关系稳定性' THEN 2                         WHEN '炉缸工况稳定性' THEN 3                         WHEN '操作炉型稳定性' THEN 4                         WHEN '煤气流分布稳定性' THEN 5                         ELSE 99                         END AS ord                 FROM T_MD_DIAGNOSE_MODEL_SUBINDEX_INFO si                 WHERE si.INDEX_ID = 'B4TEN_I'                   AND si.SUBINDEX_NAME IN ('下料稳定性','压量关系稳定性','炉缸工况稳定性','操作炉型稳定性','煤气流分布稳定性')             ),              -- 子指数取值（优先同秒，其次窗内，再次回溯 5 分钟）             sub_val AS (                 SELECT                     tp.w,                     sd.SUBINDEX_ID,                     sd.SUBINDEX_NAME,                     sd.subIndexCode,                     sd.subIndexWeight,                     d.SUBINDEX_VALUE,                     /* 三档优先级：0=同秒；1=窗内；2=回溯窗口（t_start-5min, t_start) */                     CASE                         WHEN d.GENERATE_TIME = tp.gt THEN 0                         WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                         ELSE 2                         END AS pref,                     d.GENERATE_TIME AS dgt,                     ROW_NUMBER() OVER (             PARTITION BY tp.w, sd.SUBINDEX_ID             ORDER BY                 CASE                     WHEN d.GENERATE_TIME = tp.gt THEN 0                     WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                     ELSE 2                 END ASC,                 d.GENERATE_TIME DESC         ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          CROSS JOIN sub_def sd                          LEFT JOIN T_MD_DIAGNOSE_MODEL_DATA_SUBINDEX d                                    ON (                                           d.SUBINDEX_ID = sd.SUBINDEX_ID      -- 方案A：按内部ID关联                                               OR d.INDEX_ID    = sd.subIndexCode     -- 方案B：按子指数编码关联（常见）                                           )                                        AND d.GENERATE_TIME BETWEEN (w.t_start - 5 MINUTES) AND w.t_end                 -- 如果存在高炉维度，可开启如下限制确保同一高炉：                 -- AND d.BLAST_ID = tp.blastId             ),             sub_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     SUBINDEX_NAME,                     subIndexCode,                     subIndexWeight,                     CASE WHEN rn = 1 THEN SUBINDEX_VALUE ELSE NULL END AS subIndexValue                 FROM sub_val                 WHERE rn = 1 OR rn IS NULL             )              -- 评价参数定义（从权重与参数信息表挂到各子指数）             param_def AS (                 SELECT                     sd.SUBINDEX_ID,                     w.PARAM_SCORE_ID         AS paramCode,                     psi.NAME                 AS paramName,                     w.WEIGHT                 AS paramWeight                 FROM sub_def sd                          JOIN T_MD_DIAGNOSE_MODEL_PARAM_WEIGHT w                               ON w.SUBINDEX_ID = sd.SUBINDEX_ID                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_INFO psi                               ON psi.PARAM_SCORE_ID = w.PARAM_SCORE_ID             ),              -- 评价参数取值（同秒对齐，FETCH_TIME = 顶层 gt）             param_val AS (                 SELECT                     tp.w,                     pd.SUBINDEX_ID,                     pd.paramCode,                     pd.paramName,                     pd.paramWeight,                     psd.DATA_VALUE           AS paramValue,                     /* 优先同秒 */                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END AS pref,                     psd.FETCH_TIME AS ft,                     ROW_NUMBER() OVER (                     PARTITION BY tp.w, pd.SUBINDEX_ID, pd.paramCode                     ORDER BY                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END ASC,                     psd.FETCH_TIME DESC                 ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN param_def pd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PARAM_SCORE_DATA psd                                    ON psd.PARAM_SCORE_ID = pd.paramCode                                        AND psd.FETCH_TIME BETWEEN w.t_start AND w.t_end             ),             param_pick AS (                 SELECT                     w, SUBINDEX_ID, paramCode, paramName, paramWeight,                     CASE WHEN rn = 1 THEN paramValue ELSE NULL END AS paramValue                 FROM param_val                 WHERE rn = 1 OR rn IS NULL             )          SELECT             -- 顶层             tp.markTime                      AS markTime,             tp.topIndexValue                 AS topIndexValue,              -- 子指数             sp.SUBINDEX_NAME                 AS subIndexName,             sp.subIndexCode                  AS subIndexCode,             sp.subIndexWeight                AS subIndexWeight,             sp.subIndexValue                 AS subIndexValue,              -- 评价参数             pp.paramName                     AS paramName,             pp.paramCode                     AS paramCode,             pp.paramWeight                   AS paramWeight,             pp.paramValue                    AS paramValue          FROM top_pick tp                  LEFT JOIN sub_pick sp                            ON sp.w = tp.w                  LEFT JOIN param_pick pp                            ON pp.w = tp.w                                AND pp.SUBINDEX_ID = sp.SUBINDEX_ID          ORDER BY tp.markTime ASC,                  CASE sp.SUBINDEX_NAME                      WHEN '下料稳定性' THEN 1                      WHEN '压量关系稳定性' THEN 2                      WHEN '炉缸工况稳定性' THEN 3                      WHEN '操作炉型稳定性' THEN 4                      WHEN '煤气流分布稳定性' THEN 5                      ELSE 99                      END,                  pp.paramCode;
### Cause: com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=sd;SELECT
;<space>, DRIVER=4.34.30
; bad SQL grammar []] with root cause

com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=sd;SELECT
;<space>, DRIVER=4.34.30
	at com.ibm.db2.jcc.am.b5.a(b5.java:810) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.b5.a(b5.java:66) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.b5.a(b5.java:140) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.c(kq.java:2890) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.d(kq.java:2874) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.a(kq.java:2278) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.a(kr.java:8479) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.aa.i(aa.java:202) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.aa.b(aa.java:92) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.p.a(p.java:32) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.au.i(au.java:150) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.al(kq.java:2247) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.bq(kr.java:3909) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.a(kr.java:4792) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.b(kr.java:4363) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.bg(kr.java:3027) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.execute(kr.java:3002) ~[db2jcc-4.34.30.jar:na]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44) ~[HikariCP-6.3.2.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.2.jar:na]
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142) ~[mybatis-3.5.19.jar:3.5.19]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at jdk.proxy2/jdk.proxy2.$Proxy64.selectList(Unknown Source) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86) ~[mybatis-3.5.19.jar:3.5.19]
	at jdk.proxy2/jdk.proxy2.$Proxy65.selectImpactRows(Unknown Source) ~[na:na]
	at com.example.score.api.ScoreControllerNested.getNested(ScoreControllerNested.java:69) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]

2025-09-14T00:28:14.236+08:00  INFO 31312 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14T00:28:14.259+08:00  INFO 31312 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-14T00:28:14.261+08:00  INFO 31312 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-14T00:28:14.264+08:00  INFO 31312 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-14T00:28:15.721+08:00  INFO 11876 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 11876 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-14T00:28:15.723+08:00  INFO 11876 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-14T00:28:16.115+08:00  INFO 11876 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-14T00:28:16.120+08:00  INFO 11876 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-14T00:28:16.120+08:00  INFO 11876 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-14T00:28:16.149+08:00  INFO 11876 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-14T00:28:16.149+08:00  INFO 11876 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 407 ms
2025-09-14T00:28:16.416+08:00  INFO 11876 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-14T00:28:16.421+08:00  INFO 11876 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.984 seconds (process running for 1.311)
2025-09-14T00:28:19.022+08:00  INFO 11876 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14T00:28:19.023+08:00  INFO 11876 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-14T00:28:19.023+08:00  INFO 11876 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2025-09-14T00:28:19.066+08:00  INFO 11876 --- [score-api] [http-nio-8090-exec-2] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-14T00:28:19.076+08:00  INFO 11876 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-14T00:28:20.234+08:00  INFO 11876 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.ibm.db2.jcc.t4.b@366090b0
2025-09-14T00:28:20.235+08:00  INFO 11876 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-14T00:28:21.328+08:00 ERROR 11876 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-206, SQLSTATE=42703, SQLERRMC=D.INDEX_ID, DRIVER=4.34.30
### The error may exist in file [F:\Users\lenovo\Desktop\score-api\target\classes\mapper\ScoreMapper.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: WITH             -- 注意这里只声明三列，VALUES 也只给三列，避免 -418             win(w, t_start, t_end) AS (                 VALUES                     (1,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS),                     (2,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS)             ),              -- 顶层（总指数）：每窗一条（优先等于入参秒，否则窗内最新）             top_src AS (                 SELECT                     w.w,                     i.GENERATE_TIME                                    AS gt,                     VARCHAR_FORMAT(i.GENERATE_TIME,'YYYYMMDDHH24MISS') AS markTime,                     i.INDEX_VALUE                                      AS topIndexValue,                     CASE WHEN i.GENERATE_TIME = w.t_start THEN 0 ELSE 1 END AS pref                 FROM win w                          JOIN T_MD_DIAGNOSE_MODEL_DATA_INDEX i                               ON i.INDEX_ID = 'B4TEN_I'                                   AND i.GENERATE_TIME BETWEEN w.t_start AND w.t_end             ),             top_pick AS (                 SELECT w, markTime, gt, topIndexValue                 FROM (                          SELECT w, markTime, gt, topIndexValue,                                 ROW_NUMBER() OVER (PARTITION BY w ORDER BY pref ASC, gt DESC) rn                          FROM top_src                      ) t                 WHERE rn = 1             ),              -- 子指数定义清单（固定顺序 + 兜底占位）             sub_def AS (                 SELECT                     si.SUBINDEX_ID,                     si.SUBINDEX_NAME,                     si.SUBINDEX_ID   AS subIndexCode,                     si.WEIGHT     AS subIndexWeight,                     CASE si.SUBINDEX_NAME                         WHEN '下料稳定性' THEN 1                         WHEN '压量关系稳定性' THEN 2                         WHEN '炉缸工况稳定性' THEN 3                         WHEN '操作炉型稳定性' THEN 4                         WHEN '煤气流分布稳定性' THEN 5                         ELSE 99                         END AS ord                 FROM T_MD_DIAGNOSE_MODEL_SUBINDEX_INFO si                 WHERE si.INDEX_ID = 'B4TEN_I'                   AND si.SUBINDEX_NAME IN ('下料稳定性','压量关系稳定性','炉缸工况稳定性','操作炉型稳定性','煤气流分布稳定性')             ),              -- 子指数取值（优先同秒，其次窗内，再次回溯 5 分钟）             sub_val AS (                 SELECT                     tp.w,                     sd.SUBINDEX_ID,                     sd.SUBINDEX_NAME,                     sd.subIndexCode,                     sd.subIndexWeight,                     d.SUBINDEX_VALUE,                     /* 三档优先级：0=同秒；1=窗内；2=回溯窗口（t_start-5min, t_start) */                     CASE                         WHEN d.GENERATE_TIME = tp.gt THEN 0                         WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                         ELSE 2                         END AS pref,                     d.GENERATE_TIME AS dgt,                     ROW_NUMBER() OVER (             PARTITION BY tp.w, sd.SUBINDEX_ID             ORDER BY                 CASE                     WHEN d.GENERATE_TIME = tp.gt THEN 0                     WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                     ELSE 2                 END ASC,                 d.GENERATE_TIME DESC         ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          CROSS JOIN sub_def sd                          LEFT JOIN T_MD_DIAGNOSE_MODEL_DATA_SUBINDEX d                                    ON (                                           d.SUBINDEX_ID = sd.SUBINDEX_ID      -- 方案A：按内部ID关联                                               OR d.INDEX_ID    = sd.subIndexCode     -- 方案B：按子指数编码关联（常见）                                           )                                        AND d.GENERATE_TIME BETWEEN (w.t_start - 5 MINUTES) AND w.t_end                 -- 如果存在高炉维度，可开启如下限制确保同一高炉：                 -- AND d.BLAST_ID = tp.blastId             ),             sub_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     SUBINDEX_NAME,                     subIndexCode,                     subIndexWeight,                     CASE WHEN rn = 1 THEN SUBINDEX_VALUE ELSE NULL END AS subIndexValue                 FROM sub_val                 WHERE rn = 1 OR rn IS NULL             ),               -- 评价参数定义（从权重与参数信息表挂到各子指数）             param_def AS (                 SELECT                     sd.SUBINDEX_ID,                     w.PARAM_SCORE_ID         AS paramCode,                     psi.NAME                 AS paramName,                     w.WEIGHT                 AS paramWeight                 FROM sub_def sd                          JOIN T_MD_DIAGNOSE_MODEL_PARAM_WEIGHT w                               ON w.SUBINDEX_ID = sd.SUBINDEX_ID                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_INFO psi                               ON psi.PARAM_SCORE_ID = w.PARAM_SCORE_ID             ),              -- 评价参数取值（同秒对齐，FETCH_TIME = 顶层 gt）             param_val AS (                 SELECT                     tp.w,                     pd.SUBINDEX_ID,                     pd.paramCode,                     pd.paramName,                     pd.paramWeight,                     psd.DATA_VALUE           AS paramValue,                     /* 优先同秒 */                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END AS pref,                     psd.FETCH_TIME AS ft,                     ROW_NUMBER() OVER (                     PARTITION BY tp.w, pd.SUBINDEX_ID, pd.paramCode                     ORDER BY                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END ASC,                     psd.FETCH_TIME DESC                 ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN param_def pd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PARAM_SCORE_DATA psd                                    ON psd.PARAM_SCORE_ID = pd.paramCode                                        AND psd.FETCH_TIME BETWEEN w.t_start AND w.t_end             ),             param_pick AS (                 SELECT                     w, SUBINDEX_ID, paramCode, paramName, paramWeight,                     CASE WHEN rn = 1 THEN paramValue ELSE NULL END AS paramValue                 FROM param_val                 WHERE rn = 1 OR rn IS NULL             )          SELECT             -- 顶层             tp.markTime                      AS markTime,             tp.topIndexValue                 AS topIndexValue,              -- 子指数             sp.SUBINDEX_NAME                 AS subIndexName,             sp.subIndexCode                  AS subIndexCode,             sp.subIndexWeight                AS subIndexWeight,             sp.subIndexValue                 AS subIndexValue,              -- 评价参数             pp.paramName                     AS paramName,             pp.paramCode                     AS paramCode,             pp.paramWeight                   AS paramWeight,             pp.paramValue                    AS paramValue          FROM top_pick tp                  LEFT JOIN sub_pick sp                            ON sp.w = tp.w                  LEFT JOIN param_pick pp                            ON pp.w = tp.w                                AND pp.SUBINDEX_ID = sp.SUBINDEX_ID          ORDER BY tp.markTime ASC,                  CASE sp.SUBINDEX_NAME                      WHEN '下料稳定性' THEN 1                      WHEN '压量关系稳定性' THEN 2                      WHEN '炉缸工况稳定性' THEN 3                      WHEN '操作炉型稳定性' THEN 4                      WHEN '煤气流分布稳定性' THEN 5                      ELSE 99                      END,                  pp.paramCode;
### Cause: com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-206, SQLSTATE=42703, SQLERRMC=D.INDEX_ID, DRIVER=4.34.30
; bad SQL grammar []] with root cause

com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-206, SQLSTATE=42703, SQLERRMC=D.INDEX_ID, DRIVER=4.34.30
	at com.ibm.db2.jcc.am.b5.a(b5.java:810) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.b5.a(b5.java:66) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.b5.a(b5.java:140) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.c(kq.java:2890) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.d(kq.java:2874) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.a(kq.java:2278) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.a(kr.java:8479) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.aa.i(aa.java:202) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.aa.b(aa.java:92) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.p.a(p.java:32) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.au.i(au.java:150) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.al(kq.java:2247) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.bq(kr.java:3909) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.a(kr.java:4792) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.b(kr.java:4363) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.bg(kr.java:3027) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.execute(kr.java:3002) ~[db2jcc-4.34.30.jar:na]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44) ~[HikariCP-6.3.2.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.2.jar:na]
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142) ~[mybatis-3.5.19.jar:3.5.19]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at jdk.proxy2/jdk.proxy2.$Proxy64.selectList(Unknown Source) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86) ~[mybatis-3.5.19.jar:3.5.19]
	at jdk.proxy2/jdk.proxy2.$Proxy65.selectImpactRows(Unknown Source) ~[na:na]
	at com.example.score.api.ScoreControllerNested.getNested(ScoreControllerNested.java:69) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]

2025-09-14T00:33:38.837+08:00  INFO 11876 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14T00:33:38.879+08:00  INFO 11876 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-14T00:33:38.881+08:00  INFO 11876 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-14T00:33:38.884+08:00  INFO 11876 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-14T00:33:41.444+08:00  INFO 6284 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 6284 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-14T00:33:41.445+08:00  INFO 6284 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-14T00:33:41.834+08:00  INFO 6284 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-14T00:33:41.839+08:00  INFO 6284 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-14T00:33:41.839+08:00  INFO 6284 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-14T00:33:41.867+08:00  INFO 6284 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-14T00:33:41.867+08:00  INFO 6284 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 404 ms
2025-09-14T00:33:42.120+08:00  INFO 6284 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-14T00:33:42.124+08:00  INFO 6284 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.905 seconds (process running for 1.197)
2025-09-14T00:33:45.825+08:00  INFO 6284 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14T00:33:45.825+08:00  INFO 6284 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-14T00:33:45.826+08:00  INFO 6284 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-09-14T00:33:45.869+08:00  INFO 6284 --- [score-api] [http-nio-8090-exec-2] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-14T00:33:45.878+08:00  INFO 6284 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-14T00:33:46.722+08:00  INFO 6284 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.ibm.db2.jcc.t4.b@5fc428dd
2025-09-14T00:33:46.723+08:00  INFO 6284 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-14T01:04:26.042+08:00  INFO 6284 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14T01:04:26.070+08:00  INFO 6284 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-14T01:04:26.073+08:00  INFO 6284 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-14T01:04:26.075+08:00  INFO 6284 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-14T01:04:27.458+08:00  INFO 18884 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 18884 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-14T01:04:27.459+08:00  INFO 18884 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-14T01:04:27.888+08:00  INFO 18884 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-14T01:04:27.894+08:00  INFO 18884 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-14T01:04:27.895+08:00  INFO 18884 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-14T01:04:27.924+08:00  INFO 18884 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-14T01:04:27.924+08:00  INFO 18884 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 445 ms
2025-09-14T01:04:28.205+08:00  INFO 18884 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-14T01:04:28.208+08:00  INFO 18884 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.988 seconds (process running for 1.396)
2025-09-14T01:04:36.072+08:00  INFO 18884 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14T01:04:36.074+08:00  INFO 18884 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-14T01:04:36.074+08:00  INFO 18884 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2025-09-14T01:04:36.116+08:00  INFO 18884 --- [score-api] [http-nio-8090-exec-1] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-14T01:04:36.124+08:00  INFO 18884 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-14T01:04:37.488+08:00  INFO 18884 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.ibm.db2.jcc.t4.b@4d46ee76
2025-09-14T01:04:37.490+08:00  INFO 18884 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-14T01:04:37.885+08:00 ERROR 18884 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=bd;
;INTO, DRIVER=4.34.30
### The error may exist in file [F:\Users\lenovo\Desktop\score-api\target\classes\mapper\ScoreMapper.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: WITH             -- 注意这里只声明三列，VALUES 也只给三列，避免 -418             win(w, t_start, t_end) AS (                 VALUES                     (1,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS),                     (2,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS)             ),              -- 顶层（总指数）：每窗一条（优先等于入参秒，否则窗内最新）             top_src AS (                 SELECT                     w.w,                     i.GENERATE_TIME                                    AS gt,                     VARCHAR_FORMAT(i.GENERATE_TIME,'YYYYMMDDHH24MISS') AS markTime,                     i.INDEX_VALUE                                      AS topIndexValue,                     CASE WHEN i.GENERATE_TIME = w.t_start THEN 0 ELSE 1 END AS pref                 FROM win w                          JOIN T_MD_DIAGNOSE_MODEL_DATA_INDEX i                               ON i.INDEX_ID = 'B4TEN_I'                                   AND i.GENERATE_TIME BETWEEN w.t_start AND w.t_end             ),             top_pick AS (                 SELECT w, markTime, gt, topIndexValue                 FROM (                          SELECT w, markTime, gt, topIndexValue,                                 ROW_NUMBER() OVER (PARTITION BY w ORDER BY pref ASC, gt DESC) rn                          FROM top_src                      ) t                 WHERE rn = 1             ),              -- 子指数定义清单（固定顺序 + 兜底占位）             sub_def AS (                 SELECT                     si.SUBINDEX_ID,                     si.SUBINDEX_NAME,                     si.SUBINDEX_ID   AS subIndexCode,                     si.WEIGHT     AS subIndexWeight,                     CASE si.SUBINDEX_NAME                         WHEN '下料稳定性' THEN 1                         WHEN '压量关系稳定性' THEN 2                         WHEN '炉缸工况稳定性' THEN 3                         WHEN '操作炉型稳定性' THEN 4                         WHEN '煤气流分布稳定性' THEN 5                         ELSE 99                         END AS ord                 FROM T_MD_DIAGNOSE_MODEL_SUBINDEX_INFO si                 WHERE si.INDEX_ID = 'B4TEN_I'                   AND si.SUBINDEX_NAME IN ('下料稳定性','压量关系稳定性','炉缸工况稳定性','操作炉型稳定性','煤气流分布稳定性')             ),              -- 子指数取值（优先同秒，其次窗内，再次回溯 5 分钟）             sub_val AS (                 SELECT                     tp.w,                     sd.SUBINDEX_ID,                     sd.SUBINDEX_NAME,                     sd.subIndexCode,                     sd.subIndexWeight,                     d.SUBINDEX_VALUE,                     /* 三档优先级：0=同秒；1=窗内；2=回溯窗口（t_start-5min, t_start) */                     CASE                         WHEN d.GENERATE_TIME = tp.gt THEN 0                         WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                         ELSE 2                         END AS pref,                     d.GENERATE_TIME AS dgt,                     ROW_NUMBER() OVER (             PARTITION BY tp.w, sd.SUBINDEX_ID             ORDER BY                 CASE                     WHEN d.GENERATE_TIME = tp.gt THEN 0                     WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                     ELSE 2                 END ASC,                 d.GENERATE_TIME DESC         ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          CROSS JOIN sub_def sd                          LEFT JOIN T_MD_DIAGNOSE_MODEL_DATA_SUBINDEX d                                    ON d.SUBINDEX_ID = sd.SUBINDEX_ID                                        AND d.GENERATE_TIME BETWEEN (w.t_start - 5 MINUTES) AND w.t_end                 -- 如果存在高炉维度，可开启如下限制确保同一高炉：                 -- AND d.BLAST_ID = tp.blastId             ),             sub_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     SUBINDEX_NAME,                     subIndexCode,                     subIndexWeight,                     CASE WHEN rn = 1 THEN SUBINDEX_VALUE ELSE NULL END AS subIndexValue                 FROM sub_val                 WHERE rn = 1 OR rn IS NULL             ),               -- 评价参数定义（从权重与参数信息表挂到各子指数）             param_def AS (                 SELECT                     sd.SUBINDEX_ID,                     w.PARAM_SCORE_ID         AS paramCode,                     psi.NAME                 AS paramName,                     w.WEIGHT                 AS paramWeight                 FROM sub_def sd                          JOIN T_MD_DIAGNOSE_MODEL_PARAM_WEIGHT w                               ON w.SUBINDEX_ID = sd.SUBINDEX_ID                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_INFO psi                               ON psi.PARAM_SCORE_ID = w.PARAM_SCORE_ID             ),              -- 评价参数取值（同秒对齐，FETCH_TIME = 顶层 gt）             param_val AS (                 SELECT                     tp.w,                     pd.SUBINDEX_ID,                     pd.paramCode,                     pd.paramName,                     pd.paramWeight,                     psd.DATA_VALUE           AS paramValue,                     /* 优先同秒 */                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END AS pref,                     psd.FETCH_TIME AS ft,                     ROW_NUMBER() OVER (                     PARTITION BY tp.w, pd.SUBINDEX_ID, pd.paramCode                     ORDER BY                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END ASC,                     psd.FETCH_TIME DESC                 ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN param_def pd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PARAM_SCORE_DATA psd                                    ON psd.PARAM_SCORE_ID = pd.paramCode                                        AND psd.FETCH_TIME BETWEEN w.t_start AND w.t_end             ),             param_pick AS (                 SELECT                     w, SUBINDEX_ID, paramCode, paramName, paramWeight,                     CASE WHEN rn = 1 THEN paramValue ELSE NULL END AS paramValue                 FROM param_val                 WHERE rn = 1 OR rn IS NULL             ),             -- ④ 评价参数 ⇨ 公式 ⇨ 小参数编码（最多提取前4个，可按需放大）             rule_tok AS (             -- 关联到每个 paramCode 的公式             SELECT                 pp.w,                 pp.SUBINDEX_ID,                 pp.paramCode,                 r.FORMULA,                 -- 用 DB2 REGEXP_SUBSTR 提取第 n 个 BPI 编码；这里只演示前4个位                 REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 1) AS tok1,                 REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 2) AS tok2,                 REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 3) AS tok3,                 REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 4) AS tok4             FROM param_pick pp                      JOIN T_MD_DIAGNOSE_PARAM_SCORE_CALCULATE_RULE r                           ON r.PARAM_SCORE_ID = pp.paramCode         ), -- 将横向的 tok1..tok4 拆成行（UNION ALL；你也可用递归/数字表更优雅地展开）             basic_code AS (                 SELECT w, SUBINDEX_ID, paramCode, tok1 AS BASIC_PARAM_ID FROM rule_tok WHERE tok1 IS NOT NULL                 UNION ALL                 SELECT w, SUBINDEX_ID, paramCode, tok2 FROM rule_tok WHERE tok2 IS NOT NULL                 UNION ALL                 SELECT w, SUBINDEX_ID, paramCode, tok3 FROM rule_tok WHERE tok3 IS NOT NULL                 UNION ALL                 SELECT w, SUBINDEX_ID, paramCode, tok4 FROM rule_tok WHERE tok4 IS NOT NULL             ), -- 小参数元信息（名称/单位/过程ID/高炉）             basic_def AS (                 SELECT                     bc.w,                     bc.SUBINDEX_ID,                     bc.paramCode,                     bpi.BASIC_PARAM_ID   AS basicCode,                     bpi.BASIC_PARAM_NAME AS basicName,                     bpi.UNIT             AS basicUnit,                     bpi.CHUNBIAO_ID      AS procParamId,                     bi.BLAST_NAME        AS blastName                 FROM basic_code bc                          JOIN T_MD_DIAGNOSE_BASIC_PARAM_INFO bpi                               ON bpi.BASIC_PARAM_ID = bc.BASIC_PARAM_ID                          LEFT JOIN T_MD_DIAGNOSE_BLAST_INFO bi                                    ON bi.BLAST_ID = bpi.BLAST_ID             )          SELECT             -- 顶层             tp.markTime                      AS markTime,             tp.topIndexValue                 AS topIndexValue,              -- 子指数             sp.SUBINDEX_NAME                 AS subIndexName,             sp.subIndexCode                  AS subIndexCode,             sp.subIndexWeight                AS subIndexWeight,             sp.subIndexValue                 AS subIndexValue,              -- 评价参数             pp.paramName                     AS paramName,             pp.paramCode                     AS paramCode,             pp.paramWeight                   AS paramWeight,             pp.paramValue                    AS paramValue              -- 四层（骨架：静态字段，value 稍后批量补）             bd.basicName,             bd.basicCode,             bd.basicUnit,             bd.procParamId,             bd.blastName          FROM top_pick tp                  LEFT JOIN sub_pick sp                            ON sp.w = tp.w                  LEFT JOIN param_pick pp                            ON pp.w = tp.w                                AND pp.SUBINDEX_ID = sp.SUBINDEX_ID                  LEFT JOIN basic_def  bd ON bd.w = tp.w AND bd.SUBINDEX_ID = sp.SUBINDEX_ID                                 AND bd.paramCode = pp.paramCode           ORDER BY tp.markTime ASC,                  CASE sp.SUBINDEX_NAME                      WHEN '下料稳定性' THEN 1                      WHEN '压量关系稳定性' THEN 2                      WHEN '炉缸工况稳定性' THEN 3                      WHEN '操作炉型稳定性' THEN 4                      WHEN '煤气流分布稳定性' THEN 5                      ELSE 99                      END,                  pp.paramCode;
### Cause: com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=bd;
;INTO, DRIVER=4.34.30
; bad SQL grammar []] with root cause

com.ibm.db2.jcc.am.SqlSyntaxErrorException: DB2 SQL Error: SQLCODE=-104, SQLSTATE=42601, SQLERRMC=bd;
;INTO, DRIVER=4.34.30
	at com.ibm.db2.jcc.am.b5.a(b5.java:810) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.b5.a(b5.java:66) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.b5.a(b5.java:140) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.c(kq.java:2890) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.d(kq.java:2874) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.a(kq.java:2278) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.a(kr.java:8479) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.aa.i(aa.java:202) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.aa.b(aa.java:92) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.p.a(p.java:32) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.t4.au.i(au.java:150) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kq.al(kq.java:2247) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.bq(kr.java:3909) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.a(kr.java:4792) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.b(kr.java:4363) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.bg(kr.java:3027) ~[db2jcc-4.34.30.jar:na]
	at com.ibm.db2.jcc.am.kr.execute(kr.java:3002) ~[db2jcc-4.34.30.jar:na]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44) ~[HikariCP-6.3.2.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.2.jar:na]
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142) ~[mybatis-3.5.19.jar:3.5.19]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at jdk.proxy2/jdk.proxy2.$Proxy64.selectList(Unknown Source) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86) ~[mybatis-3.5.19.jar:3.5.19]
	at jdk.proxy2/jdk.proxy2.$Proxy65.selectImpactRows(Unknown Source) ~[na:na]
	at com.example.score.api.ScoreControllerNested.getNested(ScoreControllerNested.java:69) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]

2025-09-14T01:07:37.755+08:00  INFO 18884 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14T01:07:37.779+08:00  INFO 18884 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-14T01:07:37.781+08:00  INFO 18884 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-14T01:07:37.783+08:00  INFO 18884 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-14T01:07:39.116+08:00  INFO 14792 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 14792 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-14T01:07:39.117+08:00  INFO 14792 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-14T01:07:39.515+08:00  INFO 14792 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-14T01:07:39.523+08:00  INFO 14792 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-14T01:07:39.523+08:00  INFO 14792 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-14T01:07:39.551+08:00  INFO 14792 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-14T01:07:39.551+08:00  INFO 14792 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 414 ms
2025-09-14T01:07:39.813+08:00  INFO 14792 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-14T01:07:39.817+08:00  INFO 14792 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.926 seconds (process running for 1.24)
2025-09-14T01:07:41.333+08:00  INFO 14792 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14T01:07:41.333+08:00  INFO 14792 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-14T01:07:41.333+08:00  INFO 14792 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2025-09-14T01:07:41.376+08:00  INFO 14792 --- [score-api] [http-nio-8090-exec-2] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-14T01:07:41.385+08:00  INFO 14792 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-14T01:07:42.694+08:00  INFO 14792 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.ibm.db2.jcc.t4.b@5fa6bf70
2025-09-14T01:07:42.695+08:00  INFO 14792 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-14T01:30:35.507+08:00  INFO 14792 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14T01:30:35.530+08:00  INFO 14792 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-14T01:30:35.532+08:00  INFO 14792 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-14T01:30:35.534+08:00  INFO 14792 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-14T01:30:38.188+08:00  INFO 25324 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 25324 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-14T01:30:38.189+08:00  INFO 25324 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-14T01:30:38.593+08:00  INFO 25324 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-14T01:30:38.600+08:00  INFO 25324 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-14T01:30:38.600+08:00  INFO 25324 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-14T01:30:38.629+08:00  INFO 25324 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-14T01:30:38.629+08:00  INFO 25324 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 420 ms
2025-09-14T01:30:38.899+08:00  INFO 25324 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-14T01:30:38.904+08:00  INFO 25324 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.945 seconds (process running for 1.276)
2025-09-14T01:30:43.082+08:00  INFO 25324 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-14T01:30:43.082+08:00  INFO 25324 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-14T01:30:43.083+08:00  INFO 25324 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-09-14T01:30:43.130+08:00  INFO 25324 --- [score-api] [http-nio-8090-exec-2] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-14T01:30:43.139+08:00  INFO 25324 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-14T01:30:43.881+08:00  INFO 25324 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection com.ibm.db2.jcc.t4.b@14915dfd
2025-09-14T01:30:43.883+08:00  INFO 25324 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-14T01:35:20.796+08:00  INFO 25324 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-14T01:35:20.867+08:00  INFO 25324 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-14T01:35:20.874+08:00  INFO 25324 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-14T01:35:20.879+08:00  INFO 25324 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
