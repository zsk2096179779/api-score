2025-09-15T10:46:26.093+08:00  INFO 30972 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 30972 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T10:46:26.096+08:00  INFO 30972 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T10:46:26.594+08:00  INFO 30972 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T10:46:26.602+08:00  INFO 30972 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T10:46:26.603+08:00  INFO 30972 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T10:46:26.638+08:00  INFO 30972 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T10:46:26.638+08:00  INFO 30972 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 519 ms
2025-09-15T10:46:27.002+08:00  INFO 30972 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-15T10:46:27.007+08:00  INFO 30972 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 1.226 seconds (process running for 1.639)
2025-09-15T10:47:29.792+08:00  INFO 30972 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-15T10:47:29.867+08:00  INFO 30972 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-15T11:22:18.085+08:00  INFO 32576 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 32576 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T11:22:18.087+08:00  INFO 32576 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T11:22:18.551+08:00  INFO 32576 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T11:22:18.558+08:00  INFO 32576 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T11:22:18.558+08:00  INFO 32576 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T11:22:18.590+08:00  INFO 32576 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T11:22:18.591+08:00  INFO 32576 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 480 ms
2025-09-15T11:22:18.632+08:00  WARN 32576 --- [score-api] [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'scoreControllerNested': Unsatisfied dependency expressed through field 'scoreMapper': Error creating bean with name 'scoreMapper' defined in file [F:\Users\lenovo\Desktop\score-api\target\classes\com\example\score\mapper\ScoreMapper.class]: Cannot resolve reference to bean 'sqlSessionTemplate' while setting bean property 'sqlSessionTemplate'
2025-09-15T11:22:18.633+08:00  INFO 32576 --- [score-api] [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-09-15T11:22:18.643+08:00  INFO 32576 --- [score-api] [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-15T11:22:18.652+08:00 ERROR 32576 --- [score-api] [main] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Failed to configure a DataSource: 'url' attribute is not specified and no embedded datasource could be configured.

Reason: Failed to determine a suitable driver class


Action:

Consider the following:
	If you want an embedded database (H2, HSQL or Derby), please put it on the classpath.
	If you have database settings to be loaded from a particular profile you may need to activate it (the profiles dev are currently active).

2025-09-15T11:25:09.691+08:00  INFO 20004 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 20004 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T11:25:09.692+08:00  INFO 20004 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T11:25:10.095+08:00  INFO 20004 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T11:25:10.101+08:00  INFO 20004 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T11:25:10.102+08:00  INFO 20004 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T11:25:10.129+08:00  INFO 20004 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T11:25:10.129+08:00  INFO 20004 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 418 ms
2025-09-15T11:25:10.164+08:00  WARN 20004 --- [score-api] [main] ConfigServletWebServerApplicationContext : Exception encountered during context initialization - cancelling refresh attempt: org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name 'scoreControllerNested': Unsatisfied dependency expressed through field 'scoreMapper': Error creating bean with name 'scoreMapper' defined in file [F:\Users\lenovo\Desktop\score-api\target\classes\com\example\score\mapper\ScoreMapper.class]: Cannot resolve reference to bean 'sqlSessionTemplate' while setting bean property 'sqlSessionTemplate'
2025-09-15T11:25:10.165+08:00  INFO 20004 --- [score-api] [main] o.apache.catalina.core.StandardService   : Stopping service [Tomcat]
2025-09-15T11:25:10.175+08:00  INFO 20004 --- [score-api] [main] .s.b.a.l.ConditionEvaluationReportLogger : 

Error starting ApplicationContext. To display the condition evaluation report re-run your application with 'debug' enabled.
2025-09-15T11:25:10.183+08:00 ERROR 20004 --- [score-api] [main] o.s.b.d.LoggingFailureAnalysisReporter   : 

***************************
APPLICATION FAILED TO START
***************************

Description:

Failed to configure a DataSource: 'url' attribute is not specified and no embedded datasource could be configured.

Reason: Failed to determine a suitable driver class


Action:

Consider the following:
	If you want an embedded database (H2, HSQL or Derby), please put it on the classpath.
	If you have database settings to be loaded from a particular profile you may need to activate it (the profiles dev are currently active).

2025-09-15T11:36:18.659+08:00  INFO 10928 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 10928 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T11:36:18.660+08:00  INFO 10928 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T11:36:19.125+08:00  INFO 10928 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T11:36:19.134+08:00  INFO 10928 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T11:36:19.135+08:00  INFO 10928 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T11:36:19.168+08:00  INFO 10928 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T11:36:19.168+08:00  INFO 10928 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 486 ms
2025-09-15T11:36:19.520+08:00  INFO 10928 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-15T11:36:19.525+08:00  INFO 10928 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 1.143 seconds (process running for 1.449)
2025-09-15T11:37:26.676+08:00  INFO 10928 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-15T11:37:26.676+08:00  INFO 10928 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-15T11:37:26.680+08:00  INFO 10928 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-09-15T11:37:26.774+08:00  INFO 10928 --- [score-api] [http-nio-8090-exec-2] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-15T11:37:26.785+08:00  INFO 10928 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-15T11:37:27.260+08:00  INFO 10928 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection dm.jdbc.driver.DmdbConnection@7733bb6f
2025-09-15T11:37:27.264+08:00  INFO 10928 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-15T11:37:27.563+08:00 ERROR 10928 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: dm.jdbc.driver.DMException: 第 4 行, 第 17 列[VALUES]附近出现错误: 
语法分析出错
### The error may exist in file [F:\Users\lenovo\Desktop\score-api\target\classes\mapper\ScoreMapper.xml]
### The error may involve com.example.score.mapper.ScoreMapper.selectImpactRows
### The error occurred while executing a query
### SQL: WITH             -- 注意这里只声明三列，VALUES 也只给三列，避免 -418             win(w, t_start, t_end) AS (                 VALUES                     (1,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS),                     (2,                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'),                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS)             ),              -- 顶层（总指数）：每窗一条（优先等于入参秒，否则窗内最新）             top_src AS (                 SELECT                     w.w,                     i.GENERATE_TIME                                    AS gt,                     VARCHAR_FORMAT(i.GENERATE_TIME,'YYYYMMDDHH24MISS') AS markTime,                     i.INDEX_VALUE                                      AS topIndexValue,                     CASE WHEN i.GENERATE_TIME = w.t_start THEN 0 ELSE 1 END AS pref                 FROM win w                          JOIN T_MD_DIAGNOSE_MODEL_DATA_INDEX i                               ON i.INDEX_ID = 'B4TEN_I'                                   AND i.GENERATE_TIME BETWEEN w.t_start AND w.t_end             ),             top_pick AS (                 SELECT w, markTime, gt, topIndexValue                 FROM (                          SELECT w, markTime, gt, topIndexValue,                                 ROW_NUMBER() OVER (PARTITION BY w ORDER BY pref ASC, gt DESC) rn                          FROM top_src                      ) t                 WHERE rn = 1             ),              -- 子指数定义清单（固定顺序 + 兜底占位）             sub_def AS (                 SELECT                     si.SUBINDEX_ID,                     si.SUBINDEX_NAME,                     si.SUBINDEX_ID   AS subIndexCode,                     si.WEIGHT     AS subIndexWeight,                     CASE si.SUBINDEX_NAME                         WHEN '下料稳定性' THEN 1                         WHEN '压量关系稳定性' THEN 2                         WHEN '炉缸工况稳定性' THEN 3                         WHEN '操作炉型稳定性' THEN 4                         WHEN '煤气流分布稳定性' THEN 5                         ELSE 99                         END AS ord                 FROM T_MD_DIAGNOSE_MODEL_SUBINDEX_INFO si                 WHERE si.INDEX_ID = 'B4TEN_I'                   AND si.SUBINDEX_NAME IN ('下料稳定性','压量关系稳定性','炉缸工况稳定性','操作炉型稳定性','煤气流分布稳定性')             ),              -- 子指数取值（优先同秒，其次窗内，再次回溯 5 分钟）             sub_val AS (                 SELECT                     tp.w,                     sd.SUBINDEX_ID,                     sd.SUBINDEX_NAME,                     sd.subIndexCode,                     sd.subIndexWeight,                     d.SUBINDEX_VALUE,                     /* 三档优先级：0=同秒；1=窗内；2=回溯窗口（t_start-5min, t_start) */                     CASE                         WHEN d.GENERATE_TIME = tp.gt THEN 0                         WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                         ELSE 2                         END AS pref,                     d.GENERATE_TIME AS dgt,                     ROW_NUMBER() OVER (             PARTITION BY tp.w, sd.SUBINDEX_ID             ORDER BY                 CASE                     WHEN d.GENERATE_TIME = tp.gt THEN 0                     WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                     ELSE 2                 END ASC,                 d.GENERATE_TIME DESC         ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          CROSS JOIN sub_def sd                          LEFT JOIN T_MD_DIAGNOSE_MODEL_DATA_SUBINDEX d                                    ON d.SUBINDEX_ID = sd.SUBINDEX_ID                                        AND d.GENERATE_TIME BETWEEN (w.t_start - 5 MINUTES) AND w.t_end                 -- 如果存在高炉维度，可开启如下限制确保同一高炉：                 -- AND d.BLAST_ID = tp.blastId             ),             sub_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     SUBINDEX_NAME,                     subIndexCode,                     subIndexWeight,                     CASE WHEN rn = 1 THEN SUBINDEX_VALUE ELSE NULL END AS subIndexValue                 FROM sub_val                 WHERE rn = 1 OR rn IS NULL             ),               -- 评价参数定义（从权重与参数信息表挂到各子指数）             param_def AS (                 SELECT                     sd.SUBINDEX_ID,                     w.PARAM_SCORE_ID         AS paramCode,                     psi.NAME                 AS paramName,                     w.WEIGHT                 AS paramWeight                 FROM sub_def sd                          JOIN T_MD_DIAGNOSE_MODEL_PARAM_WEIGHT w                               ON w.SUBINDEX_ID = sd.SUBINDEX_ID                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_INFO psi                               ON psi.PARAM_SCORE_ID = w.PARAM_SCORE_ID             ),              -- 评价参数取值（同秒对齐，FETCH_TIME = 顶层 gt）             param_val AS (                 SELECT                     tp.w,                     pd.SUBINDEX_ID,                     pd.paramCode,                     pd.paramName,                     pd.paramWeight,                     psd.DATA_VALUE           AS paramValue,                     /* 优先同秒 */                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END AS pref,                     psd.FETCH_TIME AS ft,                     ROW_NUMBER() OVER (                     PARTITION BY tp.w, pd.SUBINDEX_ID, pd.paramCode                     ORDER BY                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END ASC,                     psd.FETCH_TIME DESC                 ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN param_def pd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PARAM_SCORE_DATA psd                                    ON psd.PARAM_SCORE_ID = pd.paramCode                                        AND psd.FETCH_TIME BETWEEN w.t_start AND w.t_end             ),             param_pick AS (                 SELECT                     w, SUBINDEX_ID, paramCode, paramName, paramWeight,                     CASE WHEN rn = 1 THEN paramValue ELSE NULL END AS paramValue                 FROM param_val                 WHERE rn = 1 OR rn IS NULL             ),             -- ④ 评价参数 ⇨ 公式 ⇨ 小参数编码（最多提取前4个，可按需放大）             rule_tok AS (                 SELECT                     pp.w,                     pp.SUBINDEX_ID,                     pp.paramCode,                     r.FORMULA,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 1) AS tok1,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 2) AS tok2,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 3) AS tok3,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 4) AS tok4                 FROM param_pick pp                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_CALCULATE_RULE r                               ON r.PARAM_SCORE_ID = pp.paramCode             ),              -- 将横向 tok1..tok4 拆成行             basic_code AS (                 SELECT w, SUBINDEX_ID, paramCode, tok1 AS BASIC_PARAM_ID FROM rule_tok WHERE tok1 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok2 FROM rule_tok WHERE tok2 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok3 FROM rule_tok WHERE tok3 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok4 FROM rule_tok WHERE tok4 IS NOT NULL             ),              -- 小参数元信息（名称/单位/过程ID/高炉）             basic_def AS (                 SELECT                     bc.w,                     bc.SUBINDEX_ID,                     bc.paramCode,                     bpi.BASIC_PARAM_ID   AS basicCode,                     bpi.BASIC_PARAM_NAME AS basicName,                     bpi.UNIT             AS basicUnit,                     bpi.CHUNBIAO_ID      AS procParamId,                     bi.BLAST_NAME        AS blastName                 FROM basic_code bc                          JOIN T_MD_DIAGNOSE_BASIC_PARAM_INFO bpi                               ON bpi.BASIC_PARAM_ID = bc.BASIC_PARAM_ID                          LEFT JOIN T_MD_DIAGNOSE_BLAST_INFO bi                                    ON bi.BLAST_ID = bpi.BLAST_ID             ),              -- ⑤ 过程数据取值（只取宝山四高炉表 BG4；同秒优先，窗内次之，再向前回溯 5 分钟）             basic_val AS (                 SELECT                     tp.w,                     bd.SUBINDEX_ID,                     bd.paramCode,                     bd.basicCode,                     bd.basicName,                     bd.basicUnit,                     bd.procParamId,                     bd.blastName,                     p.VALUE              AS basicValue,                     ROW_NUMBER() OVER (                       PARTITION BY tp.w, bd.SUBINDEX_ID, bd.paramCode, bd.basicCode                       ORDER BY                         CASE WHEN p.CLOCK = tp.gt THEN 0 ELSE 1 END,                         p.CLOCK DESC                     ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN basic_def bd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PROCESSDATA_BG4 p                                    ON p.PARAMID = bd.procParamId                                        AND p.CLOCK BETWEEN (w.t_start - 5 MINUTES) AND w.t_end             ),             basic_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     paramCode,                     basicCode,                     MAX(basicName)   AS basicName,                     MAX(basicUnit)   AS basicUnit,                     MAX(procParamId) AS procParamId,                     MAX(blastName)   AS blastName,                     MAX(CASE WHEN rn = 1 THEN basicValue END) AS basicValue                 FROM basic_val                 GROUP BY w, SUBINDEX_ID, paramCode, basicCode             )          SELECT             -- 顶层             tp.markTime                      AS markTime,             tp.topIndexValue                 AS topIndexValue,              -- 子指数             sp.SUBINDEX_NAME                 AS subIndexName,             sp.subIndexCode                  AS subIndexCode,             sp.subIndexWeight                AS subIndexWeight,             sp.subIndexValue                 AS subIndexValue,              -- 评价参数             pp.paramName                     AS paramName,             pp.paramCode                     AS paramCode,             pp.paramWeight                   AS paramWeight,             pp.paramValue                    AS paramValue,              -- 第四层（骨架 + 数值）             bp.basicName,             bp.basicCode,             bp.basicUnit,             bp.procParamId,             bp.blastName,             bp.basicValue,              -- 休风标志：CHUNBIAO_ID=217 的 TIME_GRANULARITY；无则 0             COALESCE((                          SELECT CAST(MAX(b.TIME_GRANULARITY) AS INTEGER)                          FROM T_MD_DIAGNOSE_BASIC_PARAM_INFO b                          WHERE b.CHUNBIAO_ID = 217                      ), 0) AS exceptionFlag          FROM top_pick tp                  LEFT JOIN sub_pick   sp ON sp.w = tp.w                  LEFT JOIN param_pick pp ON pp.w = tp.w AND pp.SUBINDEX_ID = sp.SUBINDEX_ID                  LEFT JOIN basic_pick bp ON bp.w = tp.w AND bp.SUBINDEX_ID = sp.SUBINDEX_ID AND bp.paramCode = pp.paramCode          ORDER BY tp.markTime ASC,                  CASE sp.SUBINDEX_NAME                      WHEN '下料稳定性' THEN 1                      WHEN '压量关系稳定性' THEN 2                      WHEN '炉缸工况稳定性' THEN 3                      WHEN '操作炉型稳定性' THEN 4                      WHEN '煤气流分布稳定性' THEN 5                      ELSE 99                      END,                  pp.paramCode;
### Cause: dm.jdbc.driver.DMException: 第 4 行, 第 17 列[VALUES]附近出现错误: 
语法分析出错
; bad SQL grammar []] with root cause

dm.jdbc.driver.DMException: 第 4 行, 第 17 列[VALUES]附近出现错误: 
语法分析出错
	at dm.jdbc.driver.DBError.throwException(SourceFile:738) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.r(SourceFile:623) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.f.r(SourceFile:138) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.z(SourceFile:555) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.L(SourceFile:536) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.a(SourceFile:269) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.a(SourceFile:792) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.prepareSql(SourceFile:321) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.allocateHandle(SourceFile:246) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.<init>(SourceFile:148) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.<init>(SourceFile:198) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbConnection.do_prepareStatement(SourceFile:793) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbConnection.do_prepareStatement(SourceFile:779) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbConnection.prepareStatement(SourceFile:1413) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:328) ~[HikariCP-6.3.2.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java) ~[HikariCP-6.3.2.jar:na]
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:88) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:60) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142) ~[mybatis-3.5.19.jar:3.5.19]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at jdk.proxy2/jdk.proxy2.$Proxy63.selectList(Unknown Source) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86) ~[mybatis-3.5.19.jar:3.5.19]
	at jdk.proxy2/jdk.proxy2.$Proxy64.selectImpactRows(Unknown Source) ~[na:na]
	at com.example.score.api.ScoreControllerNested.getNested(ScoreControllerNested.java:69) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]

2025-09-15T11:42:53.918+08:00  INFO 10928 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-15T11:42:53.953+08:00  INFO 10928 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-15T11:42:53.955+08:00  INFO 10928 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-15T11:42:53.956+08:00  INFO 10928 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-15T11:42:55.338+08:00  INFO 2076 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 2076 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T11:42:55.340+08:00  INFO 2076 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T11:42:55.762+08:00  INFO 2076 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T11:42:55.768+08:00  INFO 2076 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T11:42:55.768+08:00  INFO 2076 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T11:42:55.799+08:00  INFO 2076 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T11:42:55.799+08:00  INFO 2076 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 439 ms
2025-09-15T11:42:56.076+08:00  INFO 2076 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-15T11:42:56.080+08:00  INFO 2076 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.99 seconds (process running for 1.326)
2025-09-15T11:43:08.248+08:00  INFO 2076 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-15T11:43:08.248+08:00  INFO 2076 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-15T11:43:08.249+08:00  INFO 2076 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-09-15T11:43:08.295+08:00  INFO 2076 --- [score-api] [http-nio-8090-exec-1] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-15T11:43:08.304+08:00  INFO 2076 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-15T11:43:08.632+08:00  INFO 2076 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection dm.jdbc.driver.DmdbConnection@64cb18d8
2025-09-15T11:43:08.633+08:00  INFO 2076 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-15T11:43:08.846+08:00 ERROR 2076 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.jdbc.BadSqlGrammarException: 
### Error querying database.  Cause: dm.jdbc.driver.DMException: 第 12 行, 第 36 列[AS]附近出现错误: 
语法分析出错
### The error may exist in file [F:\Users\lenovo\Desktop\score-api\target\classes\mapper\ScoreMapper.xml]
### The error may involve com.example.score.mapper.ScoreMapper.selectImpactRows
### The error occurred while executing a query
### SQL: --         WITH --             -- 注意这里只声明三列，VALUES 也只给三列，避免 -418 --             win(w, t_start, t_end) AS ( --                 VALUES --                     (1, --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'), --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS), --                     (2, --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'), --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS) --             ),             win(w, t_start, t_end) AS (                 SELECT 1,                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS'),                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS') + INTERVAL '59' SECOND                   FROM DUAL                 UNION ALL                 SELECT 2,                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS'),                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS') + INTERVAL '59' SECOND                   FROM DUAL               ),              -- 顶层（总指数）：每窗一条（优先等于入参秒，否则窗内最新）             top_src AS (                 SELECT                     w.w,                     i.GENERATE_TIME                                    AS gt, --                     VARCHAR_FORMAT(i.GENERATE_TIME,'YYYYMMDDHH24MISS') AS markTime,                     TO_CHAR(i.GENERATE_TIME,'YYYYMMDDHH24MISS')        AS markTime,                     i.INDEX_VALUE                                      AS topIndexValue,                     CASE WHEN i.GENERATE_TIME = w.t_start THEN 0 ELSE 1 END AS pref                 FROM win w                          JOIN T_MD_DIAGNOSE_MODEL_DATA_INDEX i                               ON i.INDEX_ID = 'B4TEN_I'                                   AND i.GENERATE_TIME BETWEEN w.t_start AND w.t_end             ),             top_pick AS (                 SELECT w, markTime, gt, topIndexValue                 FROM (                          SELECT w, markTime, gt, topIndexValue,                                 ROW_NUMBER() OVER (PARTITION BY w ORDER BY pref ASC, gt DESC) rn                          FROM top_src                      ) t                 WHERE rn = 1             ),              -- 子指数定义清单（固定顺序 + 兜底占位）             sub_def AS (                 SELECT                     si.SUBINDEX_ID,                     si.SUBINDEX_NAME,                     si.SUBINDEX_ID   AS subIndexCode,                     si.WEIGHT     AS subIndexWeight,                     CASE si.SUBINDEX_NAME                         WHEN '下料稳定性' THEN 1                         WHEN '压量关系稳定性' THEN 2                         WHEN '炉缸工况稳定性' THEN 3                         WHEN '操作炉型稳定性' THEN 4                         WHEN '煤气流分布稳定性' THEN 5                         ELSE 99                         END AS ord                 FROM T_MD_DIAGNOSE_MODEL_SUBINDEX_INFO si                 WHERE si.INDEX_ID = 'B4TEN_I'                   AND si.SUBINDEX_NAME IN ('下料稳定性','压量关系稳定性','炉缸工况稳定性','操作炉型稳定性','煤气流分布稳定性')             ),              -- 子指数取值（优先同秒，其次窗内，再次回溯 5 分钟）             sub_val AS (                 SELECT                     tp.w,                     sd.SUBINDEX_ID,                     sd.SUBINDEX_NAME,                     sd.subIndexCode,                     sd.subIndexWeight,                     d.SUBINDEX_VALUE,                     /* 三档优先级：0=同秒；1=窗内；2=回溯窗口（t_start-5min, t_start) */                     CASE                         WHEN d.GENERATE_TIME = tp.gt THEN 0                         WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                         ELSE 2                         END AS pref,                     d.GENERATE_TIME AS dgt,                     ROW_NUMBER() OVER (             PARTITION BY tp.w, sd.SUBINDEX_ID             ORDER BY                 CASE                     WHEN d.GENERATE_TIME = tp.gt THEN 0                     WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                     ELSE 2                 END ASC,                 d.GENERATE_TIME DESC         ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          CROSS JOIN sub_def sd                          LEFT JOIN T_MD_DIAGNOSE_MODEL_DATA_SUBINDEX d                                    ON d.SUBINDEX_ID = sd.SUBINDEX_ID                                        AND d.GENERATE_TIME BETWEEN (w.t_start - 5 MINUTES) AND w.t_end                 -- 如果存在高炉维度，可开启如下限制确保同一高炉：                 -- AND d.BLAST_ID = tp.blastId             ),             sub_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     SUBINDEX_NAME,                     subIndexCode,                     subIndexWeight,                     CASE WHEN rn = 1 THEN SUBINDEX_VALUE ELSE NULL END AS subIndexValue                 FROM sub_val                 WHERE rn = 1 OR rn IS NULL             ),               -- 评价参数定义（从权重与参数信息表挂到各子指数）             param_def AS (                 SELECT                     sd.SUBINDEX_ID,                     w.PARAM_SCORE_ID         AS paramCode,                     psi.NAME                 AS paramName,                     w.WEIGHT                 AS paramWeight                 FROM sub_def sd                          JOIN T_MD_DIAGNOSE_MODEL_PARAM_WEIGHT w                               ON w.SUBINDEX_ID = sd.SUBINDEX_ID                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_INFO psi                               ON psi.PARAM_SCORE_ID = w.PARAM_SCORE_ID             ),              -- 评价参数取值（同秒对齐，FETCH_TIME = 顶层 gt）             param_val AS (                 SELECT                     tp.w,                     pd.SUBINDEX_ID,                     pd.paramCode,                     pd.paramName,                     pd.paramWeight,                     psd.DATA_VALUE           AS paramValue,                     /* 优先同秒 */                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END AS pref,                     psd.FETCH_TIME AS ft,                     ROW_NUMBER() OVER (                     PARTITION BY tp.w, pd.SUBINDEX_ID, pd.paramCode                     ORDER BY                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END ASC,                     psd.FETCH_TIME DESC                 ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN param_def pd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PARAM_SCORE_DATA psd                                    ON psd.PARAM_SCORE_ID = pd.paramCode                                        AND psd.FETCH_TIME BETWEEN w.t_start AND w.t_end             ),             param_pick AS (                 SELECT                     w, SUBINDEX_ID, paramCode, paramName, paramWeight,                     CASE WHEN rn = 1 THEN paramValue ELSE NULL END AS paramValue                 FROM param_val                 WHERE rn = 1 OR rn IS NULL             ),             -- ④ 评价参数 ⇨ 公式 ⇨ 小参数编码（最多提取前4个，可按需放大）             rule_tok AS (                 SELECT                     pp.w,                     pp.SUBINDEX_ID,                     pp.paramCode,                     r.FORMULA,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 1) AS tok1,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 2) AS tok2,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 3) AS tok3,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 4) AS tok4                 FROM param_pick pp                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_CALCULATE_RULE r                               ON r.PARAM_SCORE_ID = pp.paramCode             ),              -- 将横向 tok1..tok4 拆成行             basic_code AS (                 SELECT w, SUBINDEX_ID, paramCode, tok1 AS BASIC_PARAM_ID FROM rule_tok WHERE tok1 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok2 FROM rule_tok WHERE tok2 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok3 FROM rule_tok WHERE tok3 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok4 FROM rule_tok WHERE tok4 IS NOT NULL             ),              -- 小参数元信息（名称/单位/过程ID/高炉）             basic_def AS (                 SELECT                     bc.w,                     bc.SUBINDEX_ID,                     bc.paramCode,                     bpi.BASIC_PARAM_ID   AS basicCode,                     bpi.BASIC_PARAM_NAME AS basicName,                     bpi.UNIT             AS basicUnit,                     bpi.CHUNBIAO_ID      AS procParamId,                     bi.BLAST_NAME        AS blastName                 FROM basic_code bc                          JOIN T_MD_DIAGNOSE_BASIC_PARAM_INFO bpi                               ON bpi.BASIC_PARAM_ID = bc.BASIC_PARAM_ID                          LEFT JOIN T_MD_DIAGNOSE_BLAST_INFO bi                                    ON bi.BLAST_ID = bpi.BLAST_ID             ),              -- ⑤ 过程数据取值（只取宝山四高炉表 BG4；同秒优先，窗内次之，再向前回溯 5 分钟）             basic_val AS (                 SELECT                     tp.w,                     bd.SUBINDEX_ID,                     bd.paramCode,                     bd.basicCode,                     bd.basicName,                     bd.basicUnit,                     bd.procParamId,                     bd.blastName,                     p.VALUE              AS basicValue,                     ROW_NUMBER() OVER (                       PARTITION BY tp.w, bd.SUBINDEX_ID, bd.paramCode, bd.basicCode                       ORDER BY                         CASE WHEN p.CLOCK = tp.gt THEN 0 ELSE 1 END,                         p.CLOCK DESC                     ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN basic_def bd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PROCESSDATA_BG4 p                                    ON p.PARAMID = bd.procParamId                                        AND p.CLOCK BETWEEN (w.t_start - INTERVAL '5' MINUTE) AND w.t_end             ),             basic_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     paramCode,                     basicCode,                     MAX(basicName)   AS basicName,                     MAX(basicUnit)   AS basicUnit,                     MAX(procParamId) AS procParamId,                     MAX(blastName)   AS blastName,                     MAX(CASE WHEN rn = 1 THEN basicValue END) AS basicValue                 FROM basic_val                 GROUP BY w, SUBINDEX_ID, paramCode, basicCode             )          SELECT             -- 顶层             tp.markTime                      AS markTime,             tp.topIndexValue                 AS topIndexValue,              -- 子指数             sp.SUBINDEX_NAME                 AS subIndexName,             sp.subIndexCode                  AS subIndexCode,             sp.subIndexWeight                AS subIndexWeight,             sp.subIndexValue                 AS subIndexValue,              -- 评价参数             pp.paramName                     AS paramName,             pp.paramCode                     AS paramCode,             pp.paramWeight                   AS paramWeight,             pp.paramValue                    AS paramValue,              -- 第四层（骨架 + 数值）             bp.basicName,             bp.basicCode,             bp.basicUnit,             bp.procParamId,             bp.blastName,             bp.basicValue,              -- 休风标志：CHUNBIAO_ID=217 的 TIME_GRANULARITY；无则 0             COALESCE((                          SELECT CAST(MAX(b.TIME_GRANULARITY) AS INTEGER)                          FROM T_MD_DIAGNOSE_BASIC_PARAM_INFO b                          WHERE b.CHUNBIAO_ID = 217                      ), 0) AS exceptionFlag          FROM top_pick tp                  LEFT JOIN sub_pick   sp ON sp.w = tp.w                  LEFT JOIN param_pick pp ON pp.w = tp.w AND pp.SUBINDEX_ID = sp.SUBINDEX_ID                  LEFT JOIN basic_pick bp ON bp.w = tp.w AND bp.SUBINDEX_ID = sp.SUBINDEX_ID AND bp.paramCode = pp.paramCode          ORDER BY tp.markTime ASC,                  CASE sp.SUBINDEX_NAME                      WHEN '下料稳定性' THEN 1                      WHEN '压量关系稳定性' THEN 2                      WHEN '炉缸工况稳定性' THEN 3                      WHEN '操作炉型稳定性' THEN 4                      WHEN '煤气流分布稳定性' THEN 5                      ELSE 99                      END,                  pp.paramCode;
### Cause: dm.jdbc.driver.DMException: 第 12 行, 第 36 列[AS]附近出现错误: 
语法分析出错
; bad SQL grammar []] with root cause

dm.jdbc.driver.DMException: 第 12 行, 第 36 列[AS]附近出现错误: 
语法分析出错
	at dm.jdbc.driver.DBError.throwException(SourceFile:738) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.r(SourceFile:623) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.f.r(SourceFile:138) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.z(SourceFile:555) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.L(SourceFile:536) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.a(SourceFile:269) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.a(SourceFile:792) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.prepareSql(SourceFile:321) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.allocateHandle(SourceFile:246) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.<init>(SourceFile:148) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.<init>(SourceFile:198) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbConnection.do_prepareStatement(SourceFile:793) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbConnection.do_prepareStatement(SourceFile:779) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbConnection.prepareStatement(SourceFile:1413) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at com.zaxxer.hikari.pool.ProxyConnection.prepareStatement(ProxyConnection.java:328) ~[HikariCP-6.3.2.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyConnection.prepareStatement(HikariProxyConnection.java) ~[HikariCP-6.3.2.jar:na]
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.instantiateStatement(PreparedStatementHandler.java:88) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.BaseStatementHandler.prepare(BaseStatementHandler.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.prepare(RoutingStatementHandler.java:60) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.prepareStatement(SimpleExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:64) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142) ~[mybatis-3.5.19.jar:3.5.19]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at jdk.proxy2/jdk.proxy2.$Proxy63.selectList(Unknown Source) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86) ~[mybatis-3.5.19.jar:3.5.19]
	at jdk.proxy2/jdk.proxy2.$Proxy64.selectImpactRows(Unknown Source) ~[na:na]
	at com.example.score.api.ScoreControllerNested.getNested(ScoreControllerNested.java:69) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]

2025-09-15T11:44:40.585+08:00  INFO 2076 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-15T11:44:40.610+08:00  INFO 2076 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-15T11:44:40.612+08:00  INFO 2076 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-15T11:44:40.613+08:00  INFO 2076 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-15T11:44:41.973+08:00  INFO 18768 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 18768 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T11:44:41.976+08:00  INFO 18768 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T11:44:42.415+08:00  INFO 18768 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T11:44:42.423+08:00  INFO 18768 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T11:44:42.423+08:00  INFO 18768 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T11:44:42.461+08:00  INFO 18768 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T11:44:42.462+08:00  INFO 18768 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 463 ms
2025-09-15T11:44:42.785+08:00  INFO 18768 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-15T11:44:42.790+08:00  INFO 18768 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 1.061 seconds (process running for 1.408)
2025-09-15T11:45:35.930+08:00  INFO 18768 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-15T11:45:35.955+08:00  INFO 18768 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-15T11:45:37.350+08:00  INFO 26548 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 26548 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T11:45:37.351+08:00  INFO 26548 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T11:45:37.776+08:00  INFO 26548 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T11:45:37.783+08:00  INFO 26548 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T11:45:37.783+08:00  INFO 26548 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T11:45:37.814+08:00  INFO 26548 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T11:45:37.814+08:00  INFO 26548 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 443 ms
2025-09-15T11:45:38.099+08:00  INFO 26548 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-15T11:45:38.103+08:00  INFO 26548 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.999 seconds (process running for 1.33)
2025-09-15T11:45:46.887+08:00  INFO 26548 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-15T11:45:46.887+08:00  INFO 26548 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-15T11:45:46.888+08:00  INFO 26548 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2025-09-15T11:45:46.934+08:00  INFO 26548 --- [score-api] [http-nio-8090-exec-1] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-15T11:45:46.943+08:00  INFO 26548 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-15T11:45:47.262+08:00  INFO 26548 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection dm.jdbc.driver.DmdbConnection@5e76292a
2025-09-15T11:45:47.263+08:00  INFO 26548 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-15T11:46:08.659+08:00 ERROR 26548 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[.[.[/].[dispatcherServlet]    : Servlet.service() for servlet [dispatcherServlet] in context with path [] threw exception [Request processing failed: org.springframework.dao.DataIntegrityViolationException: 
### Error querying database.  Cause: dm.jdbc.driver.DMException: 请求执行超时
### The error may exist in file [F:\Users\lenovo\Desktop\score-api\target\classes\mapper\ScoreMapper.xml]
### The error may involve defaultParameterMap
### The error occurred while setting parameters
### SQL: WITH --             -- 注意这里只声明三列，VALUES 也只给三列，避免 -418 --             win(w, t_start, t_end) AS ( --                 VALUES --                     (1, --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'), --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS), --                     (2, --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS'), --                      TIMESTAMP_FORMAT(?, 'YYYYMMDDHH24MISS') + 59 SECONDS) --             ),             win(w, t_start, t_end) AS (                 SELECT 1,                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS'),                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS') + INTERVAL '59' SECOND                   FROM DUAL                 UNION ALL                 SELECT 2,                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS'),                        TO_TIMESTAMP(?, 'YYYYMMDDHH24MISS') + INTERVAL '59' SECOND                   FROM DUAL               ),              -- 顶层（总指数）：每窗一条（优先等于入参秒，否则窗内最新）             top_src AS (                 SELECT                     w.w,                     i.GENERATE_TIME                                    AS gt, --                     VARCHAR_FORMAT(i.GENERATE_TIME,'YYYYMMDDHH24MISS') AS markTime,                     TO_CHAR(i.GENERATE_TIME,'YYYYMMDDHH24MISS')        AS markTime,                     i.INDEX_VALUE                                      AS topIndexValue,                     CASE WHEN i.GENERATE_TIME = w.t_start THEN 0 ELSE 1 END AS pref                 FROM win w                          JOIN T_MD_DIAGNOSE_MODEL_DATA_INDEX i                               ON i.INDEX_ID = 'B4TEN_I'                                   AND i.GENERATE_TIME BETWEEN w.t_start AND w.t_end             ),             top_pick AS (                 SELECT w, markTime, gt, topIndexValue                 FROM (                          SELECT w, markTime, gt, topIndexValue,                                 ROW_NUMBER() OVER (PARTITION BY w ORDER BY pref ASC, gt DESC) rn                          FROM top_src                      ) t                 WHERE rn = 1             ),              -- 子指数定义清单（固定顺序 + 兜底占位）             sub_def AS (                 SELECT                     si.SUBINDEX_ID,                     si.SUBINDEX_NAME,                     si.SUBINDEX_ID   AS subIndexCode,                     si.WEIGHT     AS subIndexWeight,                     CASE si.SUBINDEX_NAME                         WHEN '下料稳定性' THEN 1                         WHEN '压量关系稳定性' THEN 2                         WHEN '炉缸工况稳定性' THEN 3                         WHEN '操作炉型稳定性' THEN 4                         WHEN '煤气流分布稳定性' THEN 5                         ELSE 99                         END AS ord                 FROM T_MD_DIAGNOSE_MODEL_SUBINDEX_INFO si                 WHERE si.INDEX_ID = 'B4TEN_I'                   AND si.SUBINDEX_NAME IN ('下料稳定性','压量关系稳定性','炉缸工况稳定性','操作炉型稳定性','煤气流分布稳定性')             ),              -- 子指数取值（优先同秒，其次窗内，再次回溯 5 分钟）             sub_val AS (                 SELECT                     tp.w,                     sd.SUBINDEX_ID,                     sd.SUBINDEX_NAME,                     sd.subIndexCode,                     sd.subIndexWeight,                     d.SUBINDEX_VALUE,                     /* 三档优先级：0=同秒；1=窗内；2=回溯窗口（t_start-5min, t_start) */                     CASE                         WHEN d.GENERATE_TIME = tp.gt THEN 0                         WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                         ELSE 2                         END AS pref,                     d.GENERATE_TIME AS dgt,                     ROW_NUMBER() OVER (             PARTITION BY tp.w, sd.SUBINDEX_ID             ORDER BY                 CASE                     WHEN d.GENERATE_TIME = tp.gt THEN 0                     WHEN d.GENERATE_TIME BETWEEN w.t_start AND w.t_end THEN 1                     ELSE 2                 END ASC,                 d.GENERATE_TIME DESC         ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          CROSS JOIN sub_def sd                          LEFT JOIN T_MD_DIAGNOSE_MODEL_DATA_SUBINDEX d                                    ON d.SUBINDEX_ID = sd.SUBINDEX_ID                                        AND d.GENERATE_TIME BETWEEN (w.t_start - INTERVAL '5' MINUTE) AND w.t_end                 -- 如果存在高炉维度，可开启如下限制确保同一高炉：                 -- AND d.BLAST_ID = tp.blastId             ),             sub_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     SUBINDEX_NAME,                     subIndexCode,                     subIndexWeight,                     CASE WHEN rn = 1 THEN SUBINDEX_VALUE ELSE NULL END AS subIndexValue                 FROM sub_val                 WHERE rn = 1 OR rn IS NULL             ),               -- 评价参数定义（从权重与参数信息表挂到各子指数）             param_def AS (                 SELECT                     sd.SUBINDEX_ID,                     w.PARAM_SCORE_ID         AS paramCode,                     psi.NAME                 AS paramName,                     w.WEIGHT                 AS paramWeight                 FROM sub_def sd                          JOIN T_MD_DIAGNOSE_MODEL_PARAM_WEIGHT w                               ON w.SUBINDEX_ID = sd.SUBINDEX_ID                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_INFO psi                               ON psi.PARAM_SCORE_ID = w.PARAM_SCORE_ID             ),              -- 评价参数取值（同秒对齐，FETCH_TIME = 顶层 gt）             param_val AS (                 SELECT                     tp.w,                     pd.SUBINDEX_ID,                     pd.paramCode,                     pd.paramName,                     pd.paramWeight,                     psd.DATA_VALUE           AS paramValue,                     /* 优先同秒 */                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END AS pref,                     psd.FETCH_TIME AS ft,                     ROW_NUMBER() OVER (                     PARTITION BY tp.w, pd.SUBINDEX_ID, pd.paramCode                     ORDER BY                     CASE WHEN psd.FETCH_TIME = tp.gt THEN 0 ELSE 1 END ASC,                     psd.FETCH_TIME DESC                 ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN param_def pd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PARAM_SCORE_DATA psd                                    ON psd.PARAM_SCORE_ID = pd.paramCode                                        AND psd.FETCH_TIME BETWEEN w.t_start AND w.t_end             ),             param_pick AS (                 SELECT                     w, SUBINDEX_ID, paramCode, paramName, paramWeight,                     CASE WHEN rn = 1 THEN paramValue ELSE NULL END AS paramValue                 FROM param_val                 WHERE rn = 1 OR rn IS NULL             ),             -- ④ 评价参数 ⇨ 公式 ⇨ 小参数编码（最多提取前4个，可按需放大）             rule_tok AS (                 SELECT                     pp.w,                     pp.SUBINDEX_ID,                     pp.paramCode,                     r.FORMULA,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 1) AS tok1,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 2) AS tok2,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 3) AS tok3,                     REGEXP_SUBSTR(r.FORMULA, 'BPI[0-9]+', 1, 4) AS tok4                 FROM param_pick pp                          JOIN T_MD_DIAGNOSE_PARAM_SCORE_CALCULATE_RULE r                               ON r.PARAM_SCORE_ID = pp.paramCode             ),              -- 将横向 tok1..tok4 拆成行             basic_code AS (                 SELECT w, SUBINDEX_ID, paramCode, tok1 AS BASIC_PARAM_ID FROM rule_tok WHERE tok1 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok2 FROM rule_tok WHERE tok2 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok3 FROM rule_tok WHERE tok3 IS NOT NULL                 UNION ALL SELECT w, SUBINDEX_ID, paramCode, tok4 FROM rule_tok WHERE tok4 IS NOT NULL             ),              -- 小参数元信息（名称/单位/过程ID/高炉）             basic_def AS (                 SELECT                     bc.w,                     bc.SUBINDEX_ID,                     bc.paramCode,                     bpi.BASIC_PARAM_ID   AS basicCode,                     bpi.BASIC_PARAM_NAME AS basicName,                     bpi.UNIT             AS basicUnit,                     bpi.CHUNBIAO_ID      AS procParamId,                     bi.BLAST_NAME        AS blastName                 FROM basic_code bc                          JOIN T_MD_DIAGNOSE_BASIC_PARAM_INFO bpi                               ON bpi.BASIC_PARAM_ID = bc.BASIC_PARAM_ID                          LEFT JOIN T_MD_DIAGNOSE_BLAST_INFO bi                                    ON bi.BLAST_ID = bpi.BLAST_ID             ),              -- ⑤ 过程数据取值（只取宝山四高炉表 BG4；同秒优先，窗内次之，再向前回溯 5 分钟）             basic_val AS (                 SELECT                     tp.w,                     bd.SUBINDEX_ID,                     bd.paramCode,                     bd.basicCode,                     bd.basicName,                     bd.basicUnit,                     bd.procParamId,                     bd.blastName,                     p.VALUE              AS basicValue,                     ROW_NUMBER() OVER (                       PARTITION BY tp.w, bd.SUBINDEX_ID, bd.paramCode, bd.basicCode                       ORDER BY                         CASE WHEN p.CLOCK = tp.gt THEN 0 ELSE 1 END,                         p.CLOCK DESC                     ) rn                 FROM top_pick tp                          JOIN win w ON w.w = tp.w                          JOIN basic_def bd ON 1=1                          LEFT JOIN T_MD_DIAGNOSE_PROCESSDATA_BG4 p                                    ON p.PARAMID = bd.procParamId                                        AND p.CLOCK BETWEEN (w.t_start - INTERVAL '5' MINUTE) AND w.t_end             ),             basic_pick AS (                 SELECT                     w,                     SUBINDEX_ID,                     paramCode,                     basicCode,                     MAX(basicName)   AS basicName,                     MAX(basicUnit)   AS basicUnit,                     MAX(procParamId) AS procParamId,                     MAX(blastName)   AS blastName,                     MAX(CASE WHEN rn = 1 THEN basicValue END) AS basicValue                 FROM basic_val                 GROUP BY w, SUBINDEX_ID, paramCode, basicCode             )          SELECT             -- 顶层             tp.markTime                      AS markTime,             tp.topIndexValue                 AS topIndexValue,              -- 子指数             sp.SUBINDEX_NAME                 AS subIndexName,             sp.subIndexCode                  AS subIndexCode,             sp.subIndexWeight                AS subIndexWeight,             sp.subIndexValue                 AS subIndexValue,              -- 评价参数             pp.paramName                     AS paramName,             pp.paramCode                     AS paramCode,             pp.paramWeight                   AS paramWeight,             pp.paramValue                    AS paramValue,              -- 第四层（骨架 + 数值）             bp.basicName,             bp.basicCode,             bp.basicUnit,             bp.procParamId,             bp.blastName,             bp.basicValue,              -- 休风标志：CHUNBIAO_ID=217 的 TIME_GRANULARITY；无则 0             COALESCE((                          SELECT CAST(MAX(b.TIME_GRANULARITY) AS INTEGER)                          FROM T_MD_DIAGNOSE_BASIC_PARAM_INFO b                          WHERE b.CHUNBIAO_ID = 217                      ), 0) AS exceptionFlag          FROM top_pick tp                  LEFT JOIN sub_pick   sp ON sp.w = tp.w                  LEFT JOIN param_pick pp ON pp.w = tp.w AND pp.SUBINDEX_ID = sp.SUBINDEX_ID                  LEFT JOIN basic_pick bp ON bp.w = tp.w AND bp.SUBINDEX_ID = sp.SUBINDEX_ID AND bp.paramCode = pp.paramCode          ORDER BY tp.markTime ASC,                  CASE sp.SUBINDEX_NAME                      WHEN '下料稳定性' THEN 1                      WHEN '压量关系稳定性' THEN 2                      WHEN '炉缸工况稳定性' THEN 3                      WHEN '操作炉型稳定性' THEN 4                      WHEN '煤气流分布稳定性' THEN 5                      ELSE 99                      END,                  pp.paramCode;
### Cause: dm.jdbc.driver.DMException: 请求执行超时
; 请求执行超时] with root cause

dm.jdbc.driver.DMException: 请求执行超时
	at dm.jdbc.driver.DBError.throwException(SourceFile:738) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.r(SourceFile:623) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.f.r(SourceFile:138) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.z(SourceFile:555) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.y.L(SourceFile:536) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.a(SourceFile:269) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.a(SourceFile:1218) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.b(SourceFile:1045) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.a.a.a(SourceFile:829) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.executeInner(SourceFile:513) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.do_execute(SourceFile:593) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement$6.run(SourceFile:2150) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement$6.run(SourceFile:1) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at dm.jdbc.driver.DmdbPreparedStatement.execute(SourceFile:2166) ~[DmJdbcDriver18-8.1.3.140.jar:- 8.1.3.140 - Production]
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.execute(ProxyPreparedStatement.java:44) ~[HikariCP-6.3.2.jar:na]
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.execute(HikariProxyPreparedStatement.java) ~[HikariCP-6.3.2.jar:na]
	at org.apache.ibatis.executor.statement.PreparedStatementHandler.query(PreparedStatementHandler.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.statement.RoutingStatementHandler.query(RoutingStatementHandler.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.SimpleExecutor.doQuery(SimpleExecutor.java:65) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.queryFromDatabase(BaseExecutor.java:336) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.BaseExecutor.query(BaseExecutor.java:158) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:110) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.executor.CachingExecutor.query(CachingExecutor.java:90) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:154) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.session.defaults.DefaultSqlSession.selectList(DefaultSqlSession.java:142) ~[mybatis-3.5.19.jar:3.5.19]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate$SqlSessionInterceptor.invoke(SqlSessionTemplate.java:333) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at jdk.proxy2/jdk.proxy2.$Proxy63.selectList(Unknown Source) ~[na:na]
	at org.mybatis.spring.SqlSessionTemplate.selectList(SqlSessionTemplate.java:194) ~[mybatis-spring-3.0.5.jar:3.0.5]
	at org.apache.ibatis.binding.MapperMethod.executeForMany(MapperMethod.java:147) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperMethod.execute(MapperMethod.java:80) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy$PlainMethodInvoker.invoke(MapperProxy.java:141) ~[mybatis-3.5.19.jar:3.5.19]
	at org.apache.ibatis.binding.MapperProxy.invoke(MapperProxy.java:86) ~[mybatis-3.5.19.jar:3.5.19]
	at jdk.proxy2/jdk.proxy2.$Proxy64.selectImpactRows(Unknown Source) ~[na:na]
	at com.example.score.api.ScoreControllerNested.getNested(ScoreControllerNested.java:69) ~[classes/:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[na:na]
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[na:na]
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[na:na]
	at java.base/java.lang.reflect.Method.invoke(Method.java:569) ~[na:na]
	at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:258) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:191) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:118) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:991) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:896) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1089) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:979) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1014) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:914) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:590) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:885) ~[spring-webmvc-6.2.10.jar:6.2.10]
	at jakarta.servlet.http.HttpServlet.service(HttpServlet.java:658) ~[tomcat-embed-core-10.1.44.jar:6.0]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:195) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:51) ~[tomcat-embed-websocket-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) ~[spring-web-6.2.10.jar:6.2.10]
	at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:116) ~[spring-web-6.2.10.jar:6.2.10]
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:164) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:140) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:167) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:90) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:483) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:116) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:93) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:344) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:398) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:903) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1769) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:52) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1189) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:658) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:63) ~[tomcat-embed-core-10.1.44.jar:10.1.44]
	at java.base/java.lang.Thread.run(Thread.java:840) ~[na:na]

2025-09-15T11:54:33.567+08:00  INFO 26548 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-15T11:54:33.610+08:00  INFO 26548 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-15T11:54:33.615+08:00  INFO 26548 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-15T11:54:33.617+08:00  INFO 26548 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-15T11:54:35.335+08:00  INFO 2108 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 2108 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T11:54:35.336+08:00  INFO 2108 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T11:54:35.751+08:00  INFO 2108 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T11:54:35.757+08:00  INFO 2108 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T11:54:35.758+08:00  INFO 2108 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T11:54:35.788+08:00  INFO 2108 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T11:54:35.788+08:00  INFO 2108 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 432 ms
2025-09-15T11:54:36.067+08:00  INFO 2108 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-15T11:54:36.071+08:00  INFO 2108 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 0.977 seconds (process running for 1.289)
2025-09-15T11:54:43.907+08:00  INFO 2108 --- [score-api] [http-nio-8090-exec-2] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-15T11:54:43.907+08:00  INFO 2108 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-15T11:54:43.908+08:00  INFO 2108 --- [score-api] [http-nio-8090-exec-2] o.s.web.servlet.DispatcherServlet        : Completed initialization in 1 ms
2025-09-15T11:54:44.015+08:00  INFO 2108 --- [score-api] [http-nio-8090-exec-2] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-15T11:54:44.058+08:00  INFO 2108 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-15T11:54:44.491+08:00  INFO 2108 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection dm.jdbc.driver.DmdbConnection@239cc4e1
2025-09-15T11:54:44.498+08:00  INFO 2108 --- [score-api] [http-nio-8090-exec-2] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-15T12:00:32.391+08:00  INFO 2108 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-15T12:00:32.416+08:00  INFO 2108 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-15T12:00:32.418+08:00  INFO 2108 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-15T12:00:32.420+08:00  INFO 2108 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
2025-09-15T12:00:33.816+08:00  INFO 33252 --- [score-api] [main] com.example.score.ScoreApiApplication    : Starting ScoreApiApplication using Java 17.0.14 with PID 33252 (F:\Users\lenovo\Desktop\score-api\target\classes started by lenovo in F:\Users\lenovo\Desktop\score-api)
2025-09-15T12:00:33.818+08:00  INFO 33252 --- [score-api] [main] com.example.score.ScoreApiApplication    : The following 1 profile is active: "dev"
2025-09-15T12:00:34.268+08:00  INFO 33252 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port 8090 (http)
2025-09-15T12:00:34.275+08:00  INFO 33252 --- [score-api] [main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]
2025-09-15T12:00:34.275+08:00  INFO 33252 --- [score-api] [main] o.apache.catalina.core.StandardEngine    : Starting Servlet engine: [Apache Tomcat/10.1.44]
2025-09-15T12:00:34.306+08:00  INFO 33252 --- [score-api] [main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2025-09-15T12:00:34.306+08:00  INFO 33252 --- [score-api] [main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 458 ms
2025-09-15T12:00:34.589+08:00  INFO 33252 --- [score-api] [main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port 8090 (http) with context path '/'
2025-09-15T12:00:34.593+08:00  INFO 33252 --- [score-api] [main] com.example.score.ScoreApiApplication    : Started ScoreApiApplication in 1.1 seconds (process running for 1.412)
2025-09-15T12:00:37.288+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring DispatcherServlet 'dispatcherServlet'
2025-09-15T12:00:37.290+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Initializing Servlet 'dispatcherServlet'
2025-09-15T12:00:37.290+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-1] o.s.web.servlet.DispatcherServlet        : Completed initialization in 0 ms
2025-09-15T12:00:37.335+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-1] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-15T12:00:37.345+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Starting...
2025-09-15T12:00:37.671+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.pool.HikariPool        : HikariPool-1 - Added connection dm.jdbc.driver.DmdbConnection@c65beaf
2025-09-15T12:00:37.673+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-1] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Start completed.
2025-09-15T12:08:53.328+08:00  INFO 33252 --- [score-api] [http-nio-8090-exec-6] c.e.score.api.ScoreControllerNested      : useDb=true, mapperPresent=true
2025-09-15T12:09:53.473+08:00  INFO 33252 --- [score-api] [SpringApplicationShutdownHook] o.s.b.w.e.tomcat.GracefulShutdown        : Commencing graceful shutdown. Waiting for active requests to complete
2025-09-15T12:09:53.575+08:00  INFO 33252 --- [score-api] [tomcat-shutdown] o.s.b.w.e.tomcat.GracefulShutdown        : Graceful shutdown complete
2025-09-15T12:09:53.579+08:00  INFO 33252 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown initiated...
2025-09-15T12:09:53.581+08:00  INFO 33252 --- [score-api] [SpringApplicationShutdownHook] com.zaxxer.hikari.HikariDataSource       : HikariPool-1 - Shutdown completed.
